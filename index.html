<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ferramentas Inteligentes - Prompt e Tradutor</title>
<style>
  body {
    background: #121212;
    color: #fff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
  }
  h1 { color: #00ffff; text-align: center; margin-bottom: 30px; }
  /* 🔥 Botões do Menu Superior - apenas estes em vermelho */
  .menu {
    display: flex;
    justify-content: center;
    margin-bottom: 25px;
    gap: 15px;
    flex-wrap: wrap;
  }
  .menu-button {
    display: inline-block;
    padding: 14px 24px;
    background: linear-gradient(135deg, #ff4444, #cc0000);
    color: #fff;
    font-weight: bold;
    font-size: 16px;
    border-radius: 12px;
    text-decoration: none;
    transition: transform 0.3s, box-shadow 0.3s;
  }
  .menu-button:hover {
    transform: scale(1.08);
    box-shadow: 0 0 20px #ff4444aa;
  }
  /* Abas */
  .tabs { display: flex; border-bottom: 2px solid #00ffff; margin-bottom: 20px; cursor: pointer; user-select: none; }
  .tab { flex: 1; padding: 12px 20px; text-align: center; background: #1a1a1a; color: #00ffff; font-weight: bold; border-radius: 8px 8px 0 0; margin-right: 4px; transition: background 0.3s; }
  .tab:last-child { margin-right: 0; }
  .tab.active { background: #00ffff; color: #000; cursor: default; }
  /* Conteúdo das abas */
  .tab-content { background: #1f1f1f; padding: 20px; border-radius: 0 8px 8px 8px; box-shadow: 0 0 15px #00ffff66; display: none; }
  .tab-content.active { display: block; }
  label { display: block; margin-top: 15px; font-weight: bold; color: #00ffff; }
  input, textarea, select, button { width: 100%; padding: 10px; margin-top: 6px; border-radius: 8px; border: 1px solid #00ffff; background: #1a1a1a; color: #00ffcc; font-size: 16px; box-sizing: border-box; }
  textarea { resize: vertical; }
  button { margin-top: 20px; background: linear-gradient(145deg, #00ffff, #00ccff); color: #000; font-weight: bold; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; border: none; }
  button:hover:not(:disabled) { transform: scale(1.05); box-shadow: 0 0 15px #00ffff; }
  button:active:not(:disabled) { box-shadow: 0 0 25px #00ffff, inset 0 0 10px #00ffff; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  #resultado, #saida, #resultadoReescrita, #outputGospel { margin-top: 10px; background: #121212; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-family: monospace; color: #00ffcc; min-height: 110px; }
  #resultado-container { display: flex; align-items: center; justify-content: space-between; margin-top: 25px; }
  #resultado-label, #resultado-label-reescrita { color: #00ffff; font-weight: bold; font-size: 1.2em; }
  #copiarBtn { width: auto; max-width: 150px; padding: 8px 15px; font-size: 14px; }
  #erro { margin-top: 10px; color: #ff4444; font-weight: bold; }
  #piclumenLink a { display: inline-block; padding: 12px 20px; background: #00ccff; color: #000; font-weight: bold; border-radius: 8px; text-decoration: none; transition: background 0.3s; }
  #piclumenLink a:hover { background: #00aacc; }
  #botoes, #botoesReescrita, #botoesGospel { display: flex; gap: 15px; margin-top: 20px; }
  #botoes button, #botoesReescrita button, #botoesGospel button { flex: 1; }
  .bloco { background: #121212; border: 1px solid #00cccc; border-radius: 8px; padding: 15px; margin-bottom: 15px; white-space: pre-wrap; box-shadow: 0 0 10px #00cccc88; position: relative; }
  .copiar { position: absolute; top: 10px; right: 10px; background: #00cccc; color: #000; border: none; border-radius: 5px; padding: 4px 8px; font-size: 12px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
  .copiar:hover { transform: scale(1.1); box-shadow: 0 0 10px #00ffff; }
  .copiar:active { box-shadow: 0 0 15px #00ffff, inset 0 0 5px #00ffff; }

  /* Estilo para a aba Gerador de Imagem */
  :root{--bg:#f3f4f6;--card:#fff;--accent:#3b82f6;--success:#10b981;--danger:#ef4444}
  .gerador-imagem .card{width:100%;max-width:900px;background:#1f1f1f;border-radius:16px;display:grid;grid-template-columns:380px 1fr;overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,.12)}
  .gerador-imagem .left{padding:28px;background:#1a1a1a;border-right:1px solid #00ffff}
  .gerador-imagem .right{padding:28px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#121212}
  .gerador-imagem h2{font-size:22px;margin-bottom:6px;color:#00ffff;font-weight:bold}
  .gerador-imagem p.sub{color:#00ffcc;font-size:13px;margin-bottom:18px}
  .gerador-imagem textarea{width:100%;min-height:120px;padding:12px;border-radius:12px;border:2px solid #00ffff;font-size:14px;resize:vertical;background:#1a1a1a;color:#00ffcc}
  .gerador-imagem select, .gerador-imagem button{width:100%;padding:12px;border-radius:10px;border:none;font-weight:600;margin-top:8px;background:#1a1a1a;color:#00ffcc}
  .gerador-imagem .btn-primary{background:linear-gradient(45deg,#00ffff,#00ccff);color:#000;cursor:pointer}
  .gerador-imagem .btn-primary[disabled]{opacity:.6;cursor:not-allowed}
  .gerador-imagem .btn-download{background:#00ccff;color:#000;display:none;margin-top:16px;cursor:pointer}
  .gerador-imagem .loading{display:none;text-align:center;color:#00ffcc}
  .gerador-imagem .canvas{width:100%;max-width:600px;border:2px dashed #00ffff;border-radius:14px;background:#121212;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
  .gerador-imagem .canvas img{width:100%;height:auto;display:block;}
  .gerador-imagem .msg{display:none;padding:10px;border-radius:8px;font-size:14px;margin-bottom:12px}
  .gerador-imagem .msg.error{background:#ff444433;color:#ff4444}
  .gerador-imagem .msg.success{background:#00ffff33;color:#00ffff}
  .gerador-imagem .small{font-size:12px;color:#00ffcc;margin-top:10px;text-align:center}
  @media(max-width:800px){
    .gerador-imagem .card{grid-template-columns:1fr;max-width:520px}
    .gerador-imagem .left{border-right:none;border-bottom:1px solid #00ffff}
  }
</style>
</head>
<body>
<!-- 🔥 Menu Chamativo -->
<nav class="menu">
  <a href="https://rass35.github.io/venda-50-prompts-youtube/"
     target="_blank" rel="noopener noreferrer" class="menu-button">
    🎥 50 Prompts para YouTube
  </a>
  <a href="https://rass35.github.io/300-prompts/"
     target="_blank" rel="noopener noreferrer" class="menu-button">
    🤖 300 Prompts para ChatGPT
  </a>
  <a href="https://rass35.github.io/1.800-prompt---pagina-de-vendas/"
     target="_blank" rel="noopener noreferrer" class="menu-button">
    🚀 1.800 Prompts para ChatGPT
  </a>
  <a href="https://infinitcast.shop/product/17468300008569776834683839094829867"
     target="_blank" rel="noopener noreferrer" class="menu-button">
    🤖 77 Agentes do ChatGPT
  </a>
</nav>
<h1>Ferramentas Inteligentes - Prompt e Tradutor</h1>
<!-- Abas -->
<div class="tabs">
  <div class="tab active" data-tab="prompt">Gerador de Prompt para Thumbnail</div>
  <div class="tab" data-tab="divisor">Divisor e Tradutor de Roteiro</div>
  <div class="tab" data-tab="reescrita">Reescrever Roteiro</div>
  <div class="tab" data-tab="gospel">Gerador de Prompt Suno Ai - Blues Gospel</div>
  <div class="tab" data-tab="gerador-imagem">Gerador de Imagem</div>
</div>
<!-- Aba Prompt Thumbnail -->
<div id="prompt" class="tab-content active">
  <label for="sujeito">Sujeito Principal</label>
  <input type="text" id="sujeito" placeholder="ex: Cantor de blues gospel, close-up, expressão intensa">
  <label for="fundo">Plano de Fundo</label>
  <input type="text" id="fundo" placeholder="ex: Palco com iluminação dramática e luz quente">
  <label for="efeitos">Efeitos Visuais</label>
  <input type="text" id="efeitos" placeholder="ex: Partículas de poeira, bokeh, brilho etéreo">
  <label for="texto">Texto na Imagem (não será traduzido)</label>
  <textarea id="texto" rows="3" placeholder="ex: Título grande e vibrante, 3D, sombra sutil"></textarea>
  <div id="botoes">
    <button onclick="gerarPromptThumbnail()">Gerar Prompt</button>
    <button onclick="limparCamposPrompt()">Limpar</button>
  </div>
  <div id="erro"></div>
  <div id="resultado-container">
    <div id="resultado-label">Prompt Gerado:</div>
    <button id="copiarBtn" onclick="copiarPromptThumbnail()">📋 Copiar</button>
  </div>
  <div id="resultado">Preencha os campos acima e clique em "Gerar Prompt".</div>
  <div id="piclumenLink">
  <a href="https://piclumen.com/app/pt/image/create" target="_blank" rel="noopener noreferrer">
    Abrir Gerador de Imagem PicLumen
  </a>
  <a href="https://chat.openai.com/" target="_blank" rel="noopener noreferrer">
    Abrir ChatGPT
  </a>
</div>
</div>
<!-- Aba Divisor e Tradutor -->
<div id="divisor" class="tab-content">
  <h2>🧠 Divisor e Tradutor de Texto Inteligente</h2>
  <textarea id="textoDivisor" placeholder="Insira seu texto aqui..."></textarea>
  <label for="ferramenta">Escolha a ferramenta:</label>
  <select id="ferramenta">
    <option value="500">Capcut – 500 caracteres</option>
    <option value="10000">Capcut Online – 10000 caracteres</option>
    <option value="6400">Clipchamp – 6400 caracteres</option>
    <option value="3000">Filmora – 3000 caracteres</option>
    <option value="2500">Eleven Labs – 2500 caracteres</option>
    <option value="2900">ttsopenai – 2900 caracteres</option>
    <option value="custom">Outro</option>
  </select>
  <input type="number" id="customChars" placeholder="Digite o limite personalizado..." style="display:none;">
  <label for="idiomaDivisor">Idioma de tradução:</label>
  <select id="idiomaDivisor">
    <option value="en">Inglês</option>
    <option value="es">Espanhol</option>
    <option value="fr">Francês</option>
    <option value="de">Alemão</option>
    <option value="it">Italiano</option>
    <option value="pt">Português</option>
  </select>
  <div style="margin-top: 10px; display: flex; gap: 10px;">
    <button onclick="dividirTexto()">🚀 Dividir e Traduzir Texto</button>
    <button onclick="limparTexto()">🧹 Limpar Texto</button>
    <button onclick="exportarTexto()">📁 Exportar Tudo</button>
  </div>
  <h3>⏱️ Tempo Estimado</h3>
  <div id="tempo">
    Velocidade normal: 00:00 (0 segundos)<br>
    Lento / Pausado: 00:00 (0 segundos)<br>
    Rápido / Dinâmico: 00:00 (0 segundos)
  </div>
  <h3>📄 Partes do Texto Traduzido</h3>
  <div id="saida"></div>
</div>
<!-- Aba Reescrever Texto - Gemini -->
<div id="reescrita" class="tab-content">
  <label for="textoOriginal">Texto Original</label>
  <textarea id="textoOriginal" rows="6" placeholder="Digite ou cole o texto a ser reescrito..."></textarea>
  <label for="estiloReescrita">Estilo de Reescrita</label>
  <select id="estiloReescrita">
    <option value="formal">Formal</option>
    <option value="informal">Informal</option>
    <option value="criativo">Criativo</option>
    <option value="conciso">Conciso</option>
    <option value="explicativo">Explicativo</option>
  </select>
  <label for="idiomaReescrita">Idioma de saída</label>
  <select id="idiomaReescrita">
    <option value="português">Português</option>
    <option value="inglês">Inglês</option>
    <option value="espanhol">Espanhol</option>
    <option value="francês">Francês</option>
    <option value="alemão">Alemão</option>
    <option value="italiano">Italiano</option>
  </select>
  <div id="botoesReescrita">
    <button onclick="gerarPromptReescrita()">Gerar Prompt</button>
    <button onclick="copiarPromptReescrita()">📋 Copiar</button>
    <button onclick="limparCamposReescrita()">🧹 Limpar</button>
  </div>
  <div id="resultado-label-reescrita">Prompt Gerado:</div>
  <div id="resultadoReescrita">Preencha o texto, escolha o estilo e o idioma para gerar o prompt.</div>
</div>

<!-- Aba Gospel -->
<div id="gospel" class="tab-content">
  <label for="hymnName">Nome do Hino:</label>
  <input type="text" id="hymnName" placeholder="Ex: Vem Cear">
  <label for="style">Estilo Musical:</label>
  <select id="style">
    <option value="Blues Gospel">Blues Gospel</option>
    <option value="New Orleans Blues">New Orleans Blues</option>
    <option value="Soul Gospel">Soul Gospel</option>
    <option value="Gospel Worship">Gospel Worship</option>
    <option value="Jazz Gospel">Jazz Gospel</option>
    <option value="R&B Gospel">R&B Gospel</option>
    <option value="Funk Gospel">Funk Gospel</option>
    <option value="Choir Gospel">Choir Gospel</option>
    <option value="Contemporary Gospel">Contemporary Gospel</option>
    <option value="Traditional Gospel">Traditional Gospel</option>
    <option value="Blues Jazz Gospel">Blues Jazz Gospel</option>
  </select>
  <label for="voice">Voz Principal:</label>
  <select id="voice">
    <option value="deep male voice">Masculina</option>
    <option value="smooth female voice">Feminina</option>
  </select>
  <label for="tempoMusical">Compasso / Tempo:</label>
  <select id="tempoMusical">
    <option value="4/4">4/4 - Ritmo padrão, 4 tempos por compasso</option>
    <option value="3/4">3/4 - Valsa, 3 tempos por compasso</option>
    <option value="6/8" selected>6/8 - Swing/Blues, 6 tempos por compasso</option>
    <option value="12/8">12/8 - Ritmo mais complexo, do tipo “shuffle” ou gospel mais arrastado</option>
  </select>
  <div id="botoesGospel">
    <button onclick="gerarPromptGospel()">Gerar Prompt</button>
    <button onclick="limparCamposGospel()">Limpar</button>
    <button onclick="copiarPromptGospel()">📋 Copiar Prompt</button>
  </div>
  <div id="outputGospel">Preencha o nome do hino e clique em "Gerar Prompt".</div>
</div>

<!-- Aba Gerador de Imagem -->
<div id="gerador-imagem" class="tab-content gerador-imagem">
  <div class="card">
    <div class="left">
      <h2>Gerador de Imagem InfinitCast</h2>
      <p class="sub">Crie imagens incríveis com AI usando Pollinations. Escolha seu estilo, proporção e gere sua arte!</p>
      <div id="errorMsg" class="msg error"></div>
      <div id="successMsg" class="msg success"></div>
      <label>Descreva sua ideia</label>
      <textarea id="promptImagem" placeholder="Ex: Um gato fofo usando óculos de sol, estilo cartoon, cores vibrantes"></textarea>
      <label>Estilo</label>
      <select id="styleImagem">
        <option value="">Nenhum</option>
        <option value="Realista">Realista</option>
        <option value="Cartoon">Cartoon</option>
        <option value="Anime">Anime</option>
        <option value="Pintura">Pintura</option>
        <option value="Arte Digital">Arte Digital</option>
        <option value="Aquarela">Aquarela</option>
      </select>
      <label>Proporção</label>
      <select id="aspectImagem">
        <option value="1:1" data-w="512" data-h="512">1:1 (512×512)</option>
        <option value="16:9" data-w="1280" data-h="720">16:9 (1280×720)</option>
        <option value="9:16" data-w="720" data-h="1280">9:16 (720×1280)</option>
      </select>
      <button id="generateBtnImagem" class="btn-primary">Gerar Imagem</button>
      <div class="small">Dica: pressione <strong>Ctrl+Enter</strong> para gerar rápido.</div>
    </div>
    <div class="right">
      <div id="loadingImagem" class="loading">⏳ Gerando imagem... (aguarde)</div>
      <div id="canvasAreaImagem" class="canvas">
        <div id="placeholderImagem" style="text-align:center;color:#00ffcc;padding:20px">
          <div style="font-size:44px">🎨</div>
          <div>Sua imagem aparecerá aqui</div>
          <div style="font-size:12px;margin-top:8px">Digite uma descrição e clique em "Gerar Imagem"</div>
        </div>
      </div>
      <button id="downloadBtnImagem" class="btn-download">Baixar imagem</button>
      <div class="small" style="margin-top:8px">Se o download automático falhar, abra a imagem em nova aba e salve manualmente.</div>
    </div>
  </div>
</div>

<script>
  // Controle das abas
  const tabs = document.querySelectorAll('.tab');
  const contents = document.querySelectorAll('.tab-content');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      contents.forEach(c => c.classList.remove('active'));
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });

  // ===== Função de tradução =====
  async function traduzir(texto, targetLang = 'en') {
    if (!texto.trim()) return "";
    try {
      const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=pt&tl=${targetLang}&dt=t&q=${encodeURIComponent(texto)}`);
      if (!res.ok) throw new Error(`Erro HTTP: ${res.status}`);
      const data = await res.json();
      return data[0].map(item => item[0]).join('');
    } catch ( error ) {
      console.error( error );
      return texto;
    }
  }

  // ===== Prompt Thumbnail =====
  async function gerarPromptThumbnail() {
    document.getElementById('erro').innerText = '';
    const sujeitoPt = document.getElementById('sujeito').value.trim();
    const fundoPt = document.getElementById('fundo').value.trim();
    const efeitosPt = document.getElementById('efeitos').value.trim();
    const textoImg = document.getElementById('texto').value.trim();
    if (!sujeitoPt && !fundoPt && !efeitosPt && !textoImg) {
      document.getElementById('resultado').innerText = 'Preencha os campos acima e clique em "Gerar Prompt".';
      return;
    }
    const [sujeitoEn, fundoEn, efeitosEn] = await Promise.all([
      traduzir(sujeitoPt),
      traduzir(fundoPt),
      traduzir(efeitosPt)
    ]);
    const textoExtra = `(stacked vertically without separators) is prominently placed...`;
    const prompt = `Professional hyper-realistic YouTube thumbnail. Close-up image, ${sujeitoEn || "[main subject here]"}. Background: ${fundoEn || "[background here]"}. Visual effects: ${efeitosEn || "[visual effects here]"}. Text: ${textoImg || "[text on image here]"} ${textoImg ? textoExtra : "[detailed text style description here]"}. Cinematic style, ultra-detailed, high contrast, Behance-inspired, designed for maximum click-through rate.`;
    document.getElementById('resultado').innerText = prompt;
  }

  function copiarPromptThumbnail() {
    const prompt = document.getElementById('resultado').innerText;
    if (!prompt || prompt.includes('Preencha')) { alert('Nada para copiar!'); return; }
    navigator.clipboard.writeText(prompt).then(() => alert('✅ Prompt copiado!'));
  }

  function limparCamposPrompt() {
    document.getElementById('sujeito').value='';
    document.getElementById('fundo').value='';
    document.getElementById('efeitos').value='';
    document.getElementById('texto').value='';
    document.getElementById('resultado').innerText='Preencha os campos acima e clique em "Gerar Prompt".';
    document.getElementById('erro').innerText='';
  }

  // ===== Divisor e Tradutor =====
  const taxaNormal = 15, taxaLento = 8, taxaRapido = 25;
  let partesGlobais = [];
  document.getElementById('ferramenta').addEventListener('change', function(){
    document.getElementById('customChars').style.display = this.value==='custom'?'block':'none';
  });

  function formatarTempo(segundos) {
    const mm = String(Math.floor(segundos/60)).padStart(2,'0');
    const ss = String(segundos%60).padStart(2,'0');
    return `${mm}:${ss} (${segundos} segundos)`;
  }

  async function traduzirTexto(texto, idioma) {
    try {
      const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${idioma}&dt=t&q=${encodeURIComponent(texto)}`);
      const data = await res.json();
      return data[0].map(t=>t[0]).join('');
    } catch(e) {
      alert('Erro na tradução: '+e.message);
      return texto;
    }
  }

  async function dividirTexto() {
    const texto=document.getElementById('textoDivisor').value.trim();
    let maxChars=parseInt(document.getElementById('ferramenta').value,10);
    if(isNaN(maxChars)) maxChars=parseInt(document.getElementById('customChars').value,10)||texto.length;
    if(!texto){ alert('Insira um texto'); return; }
    const idioma=document.getElementById('idiomaDivisor').value;
    const sentencas=texto.match(/[^.!?]+[.!?]+(\s|$)/g)||[texto];
    const partes=[]; let blocoAtual='';
    for(let s of sentencas){
      if((blocoAtual+s).length<=maxChars){
        blocoAtual+=s;
      } else {
        if(blocoAtual)partes.push(blocoAtual.trim());
        blocoAtual=s;
      }
    }
    if(blocoAtual) partes.push(blocoAtual.trim());
    partesGlobais=await Promise.all(partes.map(parte=>traduzirTexto(parte, idioma)));
    const total=texto.length, secNormal=Math.ceil(total/taxaNormal), secLento=Math.ceil(total/taxaLento), secRapido=Math.ceil(total/taxaRapido);
    document.getElementById('tempo').innerHTML=`Velocidade normal: ${formatarTempo(secNormal)}<br> Lento / Pausado: ${formatarTempo(secLento)}<br> Rápido / Dinâmico: ${formatarTempo(secRapido)}`;
    const saida=document.getElementById('saida'); saida.innerHTML='';
    partesGlobais.forEach((parte,index)=>{
      const bloco=document.createElement('div');
      bloco.className='bloco';
      const btn=document.createElement('button');
      btn.className='copiar';
      btn.textContent='Copiar';
      btn.onclick=()=>{ navigator.clipboard.writeText(parte); btn.textContent='Copiado!'; setTimeout(()=>btn.textContent='Copiar',1000); };
      bloco.innerHTML=`<strong>Parte ${index+1}:</strong><br>`+parte;
      bloco.appendChild(btn);
      saida.appendChild(bloco);
    });
  }

  function limparTexto() {
    document.getElementById('textoDivisor').value='';
    document.getElementById('tempo').innerHTML=`Velocidade normal: 00:00 (0 segundos)<br>Lento / Pausado: 00:00 (0 segundos)<br>Rápido / Dinâmico: 00:00 (0 segundos)`;
    document.getElementById('saida').innerHTML='';
    partesGlobais=[];
  }

  function exportarTexto() {
    if(partesGlobais.length===0)return alert("Nenhuma parte para exportar.");
    const blob=new Blob([partesGlobais.join("\n\n")],{type:'text/plain'});
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download='partes_traduzidas.txt';
    link.click();
  }

  // ===== Reescrita Gemini =====
  function gerarPromptReescrita() {
    const texto=document.getElementById('textoOriginal').value.trim();
    const estilo=document.getElementById('estiloReescrita').value;
    const idioma=document.getElementById('idiomaReescrita').value;
    if(!texto){ alert('Insira o texto'); return; }
    const estilosPt={
      formal:'formal, claro e profissional',
      informal:'informal, amigável e descontraído',
      criativo:'criativo e envolvente',
      conciso:'conciso e direto ao ponto',
      explicativo:'explicativo, detalhado e didático'
    };
    const estiloPt=estilosPt[estilo]||estilo;
    const prompt=`Reescreva o texto abaixo em um estilo ${estiloPt}, preservando o significado original, mas usando palavras, frases e estruturas diferentes para evitar plágio. Garanta que o conteúdo seja único, fluido e natural. Escreva o texto em ${idioma}.\n\n"""${texto}"""`;
    document.getElementById('resultadoReescrita').innerText=prompt;
  }

  function copiarPromptReescrita() {
    const prompt=document.getElementById('resultadoReescrita').innerText;
    if(!prompt.includes('Reescreva')){ alert('Nada para copiar!'); return; }
    navigator.clipboard.writeText(prompt).then(()=>alert('✅ Copiado!'));
  }

  function limparCamposReescrita() {
    document.getElementById('textoOriginal').value='';
    document.getElementById('estiloReescrita').value='formal';
    document.getElementById('idiomaReescrita').value='português';
    document.getElementById('resultadoReescrita').innerText='Preencha o texto, escolha o estilo e o idioma para gerar o prompt.';
  }

  // ===== Gospel =====
  async function gerarPromptGospel() {
    const hymnName = document.getElementById('hymnName').value.trim();
    const style = document.getElementById('style').value;
    const voice = document.getElementById('voice').value;
    const tempo = document.getElementById('tempoMusical').value;
    if(!hymnName){ alert('Preencha o nome do hino'); return; }
    const hymnNameEn = await traduzir(hymnName,'en');
    const promptMusic = `Classic ${tempo} ${style} of the hymn "${hymnNameEn}" Hammond organ, blues piano, bass, soft drums, soulful guitar, "ooh/amen" choir, ${voice}, live church atmosphere.`;
    document.getElementById('outputGospel').innerHTML=`<h2>🎵 Prompt Gerado</h2><p>${promptMusic}</p>`;
  }

  function limparCamposGospel() {
    document.getElementById('hymnName').value='';
    document.getElementById('style').selectedIndex=0;
    document.getElementById('voice').selectedIndex=0;
    document.getElementById('outputGospel').innerText='Preencha o nome do hino e clique em "Gerar Prompt".';
  }

  function copiarPromptGospel() {
    const prompt=document.getElementById('outputGospel').innerText;
    if(!prompt.includes('Preencha')){
      navigator.clipboard.writeText(prompt).then(()=>alert('✅ Prompt Gospel copiado!'));
    } else {
      alert('Nada para copiar!');
    }
  }

  // ===== Gerador de Imagem =====
  let currentWidthImagem = 512, currentHeightImagem = 512;
  let generatedImageUrlImagem = null;
  let currentImageElementImagem = null;
  let isGeneratingImagem = false;
  let currentBlobUrlImagem = null;

  function showErrorImagem(txt) {
    const el = document.getElementById('errorMsg');
    el.textContent = txt;
    el.style.display = 'block';
    setTimeout(()=> el.style.display='none', 6000);
  }

  function showSuccessImagem(txt) {
    const el = document.getElementById('successMsg');
    el.textContent = txt;
    el.style.display = 'block';
    setTimeout(()=> el.style.display='none', 3500);
  }

  function sleepImagem(ms) {
    return new Promise(r=>setTimeout(r,ms));
  }

  function loadImageWithTimeoutImagem(url, timeout = 15000) {
    return new Promise((resolve,reject)=>{
      const img = new Image();
      img.crossOrigin = 'anonymous';
      let done = false;
      const t = setTimeout(()=>{ if (!done){ done=true; img.onload=null; img.onerror=null; reject(new Error('timeout')); } }, timeout);
      img.onload = () => { if(!done){ done=true; clearTimeout(t); resolve(img); } };
      img.onerror = () => { if(!done){ done=true; clearTimeout(t); reject(new Error('load error')); } };
      img.src = url;
    });
  }

  function revokeCurrentBlobImagem() {
    if(currentBlobUrlImagem){
      try{ URL.revokeObjectURL(currentBlobUrlImagem); }catch(e){}
      currentBlobUrlImagem = null;
    }
  }

  function displayImageElementImagem(imgEl) {
    const area = document.getElementById('canvasAreaImagem');
    const placeholder = document.getElementById('placeholderImagem');
    Array.from(area.querySelectorAll('img')).forEach(i=>i.remove());
    placeholder.style.display = 'none';
    const aspectRatio = currentWidthImagem / currentHeightImagem;
    area.style.height = `${area.offsetWidth / aspectRatio}px`;
    area.appendChild(imgEl);
    currentImageElementImagem = imgEl;
    document.getElementById('downloadBtnImagem').style.display = 'block';
  }

  function generateWithCanvasFallbackImagem(prompt) {
    const canvas = document.createElement('canvas');
    canvas.width = currentWidthImagem; canvas.height = currentHeightImagem;
    const ctx = canvas.getContext('2d');
    const h = [...prompt].reduce((s,c)=> s + c.charCodeAt(0), 0);
    const colors = [
      `hsl(${h % 360} 80% 55%)`,
      `hsl(${(h+90) % 360} 65% 55%)`,
      `hsl(${(h+180) % 360} 55% 60%)`
    ];
    const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
    grad.addColorStop(0, colors[0]);
    grad.addColorStop(0.6, colors[1]);
    grad.addColorStop(1, colors[2]);
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'rgba(255,255,255,0.92)';
    ctx.font = 'bold 28px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('AI Generated', canvas.width/2, canvas.height/2 - 10);
    ctx.font = '16px Arial';
    const short = prompt.split(' ').slice(0,6).join(' ');
    ctx.fillText(short, canvas.width/2, canvas.height/2 + 20);
    return canvas.toDataURL('image/png');
  }

  function downloadBlobImagem(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(()=> URL.revokeObjectURL(url), 3500);
  }

  document.getElementById('aspectImagem').addEventListener('change', function() {
    const opt = this.selectedOptions[0];
    currentWidthImagem = parseInt(opt.dataset.w, 10) || 512;
    currentHeightImagem = parseInt(opt.dataset.h, 10) || 512;
    const area = document.getElementById('canvasAreaImagem');
    area.style.height = `${area.offsetWidth / (currentWidthImagem/currentHeightImagem)}px`;
  });

  document.getElementById('generateBtnImagem').addEventListener('click', generateImageImagem);
  document.getElementById('downloadBtnImagem').addEventListener('click', downloadImageImagem);
  document.getElementById('promptImagem').addEventListener('keydown', function(e) {
    if(e.key === 'Enter' && e.ctrlKey){ e.preventDefault(); generateImageImagem(); }
  });

  async function generateImageImagem() {
    if(isGeneratingImagem) return;
    let prompt = document.getElementById('promptImagem').value.trim();
    if(!prompt){ showErrorImagem('Por favor, descreva a imagem.'); return; }
    const style = document.getElementById('styleImagem').value;
    if(style) prompt += `, estilo ${style}`;
    revokeCurrentBlobImagem();
    generatedImageUrlImagem = null;
    currentImageElementImagem = null;
    document.getElementById('downloadBtnImagem').style.display = 'none';
    document.getElementById('placeholderImagem').style.display = 'block';
    isGeneratingImagem = true;
    const genBtn = document.getElementById('generateBtnImagem');
    genBtn.disabled = true;
    document.getElementById('loadingImagem').style.display = 'block';
    try{
      const seed = Date.now();
      const pollUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=${currentWidthImagem}&height=${currentHeightImagem}&seed=${seed}&nologo=true`;
      try{
        const loadedImg = await loadImageWithTimeoutImagem(pollUrl, 15000);
        generatedImageUrlImagem = pollUrl;
        const domImg = new Image();
        domImg.src = loadedImg.src;
        domImg.crossOrigin = 'anonymous';
        displayImageElementImagem(domImg);
        showSuccessImagem('Imagem gerada com sucesso!');
        return;
      }catch(err){ console.warn('loadImage direto falhou:', err.message); }
      try{
        const controller = new AbortController();
        const timeoutId = setTimeout(()=> controller.abort(), 15000);
        const res = await fetch(pollUrl, { method: 'GET', signal: controller.signal, mode: 'cors' });
        clearTimeout(timeoutId);
        if(res.ok){
          const blob = await res.blob();
          const blobUrl = URL.createObjectURL(blob);
          currentBlobUrlImagem = blobUrl;
          generatedImageUrlImagem = blobUrl;
          const domImg = new Image();
          domImg.src = blobUrl;
          domImg.onload = ()=> currentImageElementImagem = domImg;
          domImg.crossOrigin = 'anonymous';
          displayImageElementImagem(domImg);
          showSuccessImagem('Imagem gerada com sucesso (via fetch)!');
          return;
        }
      }catch(err){ console.warn('fetch(blob) falhou:', err); }
      const dataUrl = generateWithCanvasFallbackImagem(prompt);
      generatedImageUrlImagem = dataUrl;
      const domImg = new Image();
      domImg.src = dataUrl;
      domImg.onload = ()=> currentImageElementImagem = domImg;
      displayImageElementImagem(domImg);
      showSuccessImagem('Criada imagem alternativa (fallback).');
    } finally {
      isGeneratingImagem = false;
      genBtn.disabled = false;
      document.getElementById('loadingImagem').style.display = 'none';
    }
  }

  async function downloadImageImagem() {
    if(!generatedImageUrlImagem){ showErrorImagem('Nenhuma imagem para baixar!'); return; }
    const btn = document.getElementById('downloadBtnImagem');
    const originalText = btn.textContent;
    btn.textContent = 'Preparando...';
    btn.disabled = true;
    try{
      if(generatedImageUrlImagem.startsWith('data:')){
        const res = await fetch(generatedImageUrlImagem);
        const blob = await res.blob();
        downloadBlobImagem(blob, `imagem-ai-${Date.now()}.png`);
        showSuccessImagem('Download iniciado.');
        return;
      }
      try{
        const controller = new AbortController();
        const timeoutId = setTimeout(()=> controller.abort(), 15000);
        const res = await fetch(generatedImageUrlImagem, { method:'GET', signal: controller.signal, mode:'cors' });
        clearTimeout(timeoutId);
        if(res.ok){
          const blob = await res.blob();
          downloadBlobImagem(blob, `imagem-ai-${Date.now()}.png`);
          showSuccessImagem('Download iniciado.');
          return;
        }
      }catch(err){ console.warn('fetch para download falhou:', err); }
      try{
        const canvas = document.createElement('canvas');
        canvas.width = currentWidthImagem; canvas.height = currentHeightImagem;
        const ctx = canvas.getContext('2d');
        if(currentImageElementImagem && currentImageElementImagem.complete){
          ctx.drawImage(currentImageElementImagem, 0, 0, canvas.width, canvas.height);
        } else {
          const temp = await loadImageWithTimeoutImagem(generatedImageUrlImagem, 10000);
          ctx.drawImage(temp, 0, 0, canvas.width, canvas.height);
        }
        const blob = await new Promise((res)=> canvas.toBlob(res, 'image/png', 1.0));
        if(blob){
          downloadBlobImagem(blob, `imagem-ai-${Date.now()}.png`);
          showSuccessImagem('Download iniciado (via canvas).');
          return;
        }
      }catch(err){ console.warn('download via canvas falhou:', err); }
      const a = document.createElement('a');
      a.href = generatedImageUrlImagem;
      a.target = '_blank';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      showErrorImagem('Download automático falhou por restrição CORS. Imagem aberta em nova aba — salve manualmente.');
    } finally {
      btn.textContent = originalText;
      btn.disabled = false;
    }
  }
</script>
</body>
</html>
